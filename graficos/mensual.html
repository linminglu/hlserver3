<!DOCTYPE html>
<html> 
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="">
    <meta name="author" content="">
    <script type="text/javascript" src="https://ajax.googleapis.com/ajax/libs/jquery/1.12.0/jquery.min.js"></script>
    <link rel="stylesheet" type="text/css" href="epoch_styles.css" />
    <script type="text/javascript" src="epoch_classes.js"></script>
    <script type="text/javascript">
    var bas_cal,dp_cal,ms_cal;      
    window.onload = function () {
        dp_cal  = new Epoch('epoch_popup','popup',document.getElementById('popup_container'));
    };
    </script> 
    <script src="dist/Chart.bundle.js"></script>        

    <title>Streaming Control Panel</title>

    <!-- Bootstrap Core CSS -->
    <link href="css/bootstrap.min.css" rel="stylesheet">

    <!-- MetisMenu CSS -->
    <link href="css/metisMenu.min.css" rel="stylesheet">

    <!-- DataTables CSS -->
    <link href="css/dataTables.bootstrap.css" rel="stylesheet">

    <!-- DataTables Responsive CSS -->
    <link href="css/responsive.dataTables.scss" rel="stylesheet">

    <!-- Custom CSS -->
    <link href="css/sb-admin-2.css" rel="stylesheet">

    <!-- Custom Fonts -->
    <link href="css/font-awesome.min.css" rel="stylesheet" type="text/css">
    
    <!-- jQuery -->
    <script src="js/jquery.min.js"></script>

    <!-- Bootstrap Core JavaScript -->
    <script src="js/bootstrap.min.js"></script>

    <!-- Metis Menu Plugin JavaScript -->
    <script src="js/metisMenu.min.js"></script>

    <!-- DataTables JavaScript -->
    <script src="js/jquery.dataTables.min.js"></script>
    <script src="js/dataTables.bootstrap.min.js"></script>

    <!-- Custom Theme JavaScript -->
    <script src="js/sb-admin-2.js"></script>
</head>
<body>
<div id="wrapper">
    <nav class="navbar navbar-default navbar-static-top" role="navigation" style="margin-bottom: 0">
        <div class="navbar-header">
            <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Change navigation</span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
                <span class="icon-bar"></span>
            </button>
        <a class="navbar-brand" href="#">HLServer 3.0</a>
        </div>
        <ul class="nav navbar-top-links navbar-right hidden-xs">
            <!-- Boton superior de logout -->
            <li class="dropdown">
                <a class="dropdown-toggle" data-toggle="dropdown" href="#">
                    <i class="fa fa-user fa-fw"></i><i class="fa fa-caret-down"></i>
                </a>
                <ul class="dropdown-menu dropdown-user">
                    <li><a href="edit.html"><i class="fa fa-wrench fa-fw"></i> Settings</a></li>
                    <li><a href="ahora.html"><i class="fa fa-bar-chart fa-fw"></i> Now</a></li>
                    <li><a href="dayly.html"><i class="fa fa-pie-chart fa-fw"></i> Dayly</a></li>
                    <li><a href="mensual.html"><i class="fa fa-area-chart fa-fw"></i> Monthly</a></li>
                    <li class="divider"></li>
                    <li><a href="/logout.cgi"><i class="fa fa-sign-out fa-fw"></i> Log out</a></li>
                </ul>
            </li>
        </ul>
        <div class="navbar-default sidebar" role="navigation">
            <div class="sidebar-nav navbar-collapse">
                <ul class="nav" id="side-menu">
                    <li>
                        <a href="#"><i class="fa fa-bar-chart fa-fw"></i> Stats<span class="fa arrow"></span></a>
                        <ul class="nav nav-second-level">
                            <li>
                                <a href="ahora.html">Now</a>
                            </li>
                            <li>
                                <a href="dayly.html">Dayly</a>
                            </li>
                            <li>
                                <a href="mensual.html">Monthly</a>
                            </li>
                        </ul>
                    </li>
                    <li>
                        <a href="edit.html"><i class="fa fa-wrench fa-fw"></i> Settings</a>
                    </li>
                    <li>
                        <a href="/logout.cgi"><i class="fa fa-sign-out fa-fw"></i> Log out</a>
                    </li>
                </ul>
             </div>
        </div>
    </nav>
</div>
<div id="page-wrapper">
     <br>
     <div class="row">
        <div class="col-xs-6 col-xs-offset-3">
            <div class="panel panel-default">
                <div class="panel-body">
                    <form id="testform" action="" method="post">
                        <table align="center" style="width:100%">
                        <tr>
                            <th style="text-align:center">MONTH</th>
                            <th style="text-align:center">YEAR</th>
                            <th style="text-align:center">STREAM</th>
                        </tr>
                        <tr>
                            <td align="center"><select id="months" name="months"></select></td>
                            <td align="center"><select id="years"  name="years" ></select></td>
                            <td align="center"><select id="stream" name="stream" ></select></td>
                        </tr>
                        </table>
                    </form>
                    <br>
                    </div>
                </div>
            </div>
        </div>
     <div class="row">
     	<div class="col-xs-6 col-xs-offset-3">
          <div class="panel panel-default">
              <div class="panel-body">
		   <table id="totalMonth">
                   </table>
                </div>
            </div>
         </div>
     </div>
     <div class="row">
        <div class="col-lg-12">
                <div id="panel1" class="panel-body">
                    <div class='dataTable_wrapper'>
                        <table align='center'>
                            <tr>
                                <td>
                                    <div align='center' style='margin:2em'>
                                        <label>Audience in Players</label>
                                        <canvas id='grafico1'></canvas>
                                    </div>
                                </td>
                                <td>
                                    <div align='center' style='margin:1em'>
                                        <label>Hours of Playback</label>
                                        <canvas id='grafico2'></canvas>
                                    </div>
                                </td>
                            </tr><tr>
                            <td>
                                <div align='center' style='margin:2em'>
                                    <label>Average Time of Playback (hours)</label>
                                    <canvas id='grafico3'></canvas>
                                </div>
                            </td>
                            <td>
                                <div align='center' style='margin:1em'>
                                	<label>Traffic in Gigabytes</label>
                                    <canvas id='grafico4'></canvas>
                                </div>
                            </td>
                            </tr>
                            <tr>
                                <td>
                                    <div align='center' style='margin:2em'>
                                    	<label>Max Audience in Players</label>
                                        <canvas id='grafico5'></canvas>
                                    </div>
                                </td>
                                <td>
                                    <div align='center' style='margin:1em'>
                                        <label>Peak Times</label>
                                        <canvas id='grafico6'></canvas>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
                <div id="panel" class="panel-body">
                    <div class='dataTable_wrapper'>
                        <table align='center'>
                            <tr>
                                <td>
                                    <div id='graf1' align='center' style='margin:2em'>
                                    </div>
                                </td>
                                <td>
                                    <div id='graf2' align='center' style='margin:1em'>
                                    </div>
                                </td>
                            </tr><tr>
                            <td>
                                <div id='graf3' align='center' style='margin:2em'>
                                    
                                </div>
                            </td>
                            <td>
                                <div id='graf4' align='center' style='margin:1em'>
                                </div>
                            </td>
                            </tr>
                            <tr>
                                <td>
                                    <div id='graf5' align='center' style='margin:2em'>
                                    </div>
                                </td>
                                <td>
                                    <div id='graf6' align='center' style='margin:1em'>
                                    </div>
                                </td>
                            </tr>
                        </table>
                    </div>
                </div>
            <div id="prueba"></div>
         </div>
     </div>
</div>
    <script type="text/javascript">
        $(document).ready(function(){
            //SE GENERA EL FORMULARIO
            $.post("/getMonthsYears.cgi",  function(data, status) {
                var res = data.trim().split(";");
                $("#months").html(res[0]);
                $("#years").html(res[1]);
                $("#stream").html(res[2]); 
            });
            //TOTALES CONSUMIDOS
            $.post("/totalMonths.cgi",  function(data, status) {
            	$("#totalMonth").html(data);
            });
            //MUESTRA LOS DATOS EN LA PRIMERA RECARGA
            $.post("/firstMonthly.cgi", $("#testform").serialize(), function(data, status) {
                var data = data.split(";");
                $("#stream").html(data[6]); 
                //AUDIENCIA TOTAL DEL DIA POR PERSONAS
                var parser1 = $.parseJSON(data[0]);
                var audiencias = $("#grafico1");
                var grafo1 = new Chart(audiencias, {
                    type: parser1.type,
                    data: {
                        labels: parser1.labels,
                        datasets: [
                        {
                            label: "players",
                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                            borderColor: "rgba(67, 196, 54, 1)",
                            borderWidth: 1,
                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                            data: parser1.data,
                        }
                        ]
                    }
                });
                //TIEMPO TOTAL VISIONADO
                var parser2 = $.parseJSON(data[1]);
                var total_min = $("#grafico2");
                var grafo2 = new Chart(total_min, {
                    type: parser2.type,
                    data: {
                        labels: parser2.labels,
                        datasets: [
                        {
                            label: "hours",
                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                            borderColor: "rgba(67, 196, 54, 1)",
                            borderWidth: 1,
                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                            data: parser2.data,
                            }
                        ]
                    }
                });
                //TIEMPO MEDIO VISIONADO EN HORAS
                var parser3 = $.parseJSON(data[2]);
                var promedio = $("#grafico3");
                var grafo3 = new Chart(promedio, {
                     type: parser3.type,
                     data: {
                         labels: parser3.labels,
                         datasets: [
                            {
                                label: "hours",
                                backgroundColor: "rgba(67, 196, 54, 0.2)",
                                borderColor: "rgba(67, 196, 54, 1)",
                                borderWidth: 1,
                                hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                hoverBorderColor: "rgba(67, 196, 54, 1)",
                                data: parser3.data,
                            }
                         ]
                    }
                });
                //TRAFICO DIARIO EN GIGABYTES
                var parser4 = $.parseJSON(data[3]);
                var megas = $("#grafico4");
                var grafo4 = new Chart(megas, {
                     type: parser4.type,
                     data: {
                         labels: parser4.labels,
                         datasets: [
                            {
                                label: "GB",
                                backgroundColor: "rgba(67, 196, 54, 0.2)",
                                borderColor: "rgba(67, 196, 54, 1)",
                                borderWidth: 1,
                                hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                hoverBorderColor: "rgba(67, 196, 54, 1)",
                                data: parser4.data,
                            }
                         ]
                    }
                });
                //MAXIMO DE SIMULTANEOS EN PERSONAS
                var parser5 = $.parseJSON(data[4]);
                var maximo = $("#grafico5");
                var grafo5 = new Chart(maximo, {
                     type: parser5.type,
                     data: {
                         labels: parser5.labels,
                         datasets: [
                            {
                                label: "players",
                                backgroundColor: "rgba(67, 196, 54, 0.2)",
                                borderColor: "rgba(67, 196, 54, 1)",
                                borderWidth: 1,
                                hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                hoverBorderColor: "rgba(67, 196, 54, 1)",
                                data: parser5.data,
                            }
                         ]
                    }
                });
                //HORA DEL PICO DE AUDIENCIA
                var parser6 = $.parseJSON(data[5]);
                var horaPico = $("#grafico6");
                var grafo6 = new Chart(horaPico, {
                     type: parser6.type,
                     data: {
                         labels: parser6.labels,
                         datasets: [
                            {
                                label: "hours",
                                backgroundColor: "rgba(67, 196, 54, 0.2)",
                                borderColor: "rgba(67, 196, 54, 1)",
                                borderWidth: 1,
                                hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                hoverBorderColor: "rgba(67, 196, 54, 1)",
                                data: parser6.data,
                            }
                         ]
                    }
                });
            });
            //MUESTRA LOS DATOS DE LOS SELECTS
            $("#months, #years, #stream").change(function(){
                $("#panel1").hide();
                $.post("/createGraf.cgi", function(data, status) {
                    var graf = data.split(";");
                    $("#graf1").html(graf[0]);
                    $("#graf2").html(graf[1]);
                    $("#graf3").html(graf[2]);
                    $("#graf4").html(graf[3]);
                    $("#graf5").html(graf[4]);
                    $("#graf6").html(graf[5]);
                });
                $.post("/totalMonthsChange.cgi", $("#testform").serialize(), function(data, status) {
                	if (data == "NoBD"){
                		$("#totalMonth").html("");
                	}else{
                    	$("#totalMonth").html(data);
                	}
                });
                $.post("/graficosMonthly.cgi", $("#testform").serialize(), function(data, status) {
                        var data = data.split(";");
                        $("#stream").html(data[6]);
                        //AUDIENCIA TOTAL DEL DIA POR PERSONAS
                        var parser1 = $.parseJSON(data[0]);
                        var audiencias = $("#graficop1");
                        if (jQuery.isEmptyObject(parser1.data)){
                             var grafo1 = new Chart(audiencias, {
                             type: parser1.type,
                             data: {
                                 labels: parser1.labels,
                                 datasets: [
                                    {
                                        label: "players",
                                        backgroundColor: "rgba(255, 59, 64,0.2)",
                                        borderColor: "rgba(255, 59, 64, 1)",
                                        borderWidth: 1,
                                        hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                        hoverBorderColor: "rgba(255, 59, 64, 1)",
                                        data: [],
                                    }
                                 ]
                               },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo1 = new Chart(audiencias, {
                                 type: parser1.type,
                                 data: {
                                     labels: parser1.labels,
                                     datasets: [
                                        {
                                            label: "players",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser1.data,
                                        }
                                     ]
                                   }
                            });
                        }
                        //TIEMPO TOTAL VISIONADO
                        var parser2 = $.parseJSON(data[1]);
                        var total_min = $("#graficop2");
                        if (jQuery.isEmptyObject(parser2.data)){
                            var grafo2 = new Chart(total_min, {
                                 type: parser2.type,
                                 data: {
                                     labels: parser2.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(255, 59, 64,0.2)",
                                            borderColor: "rgba(255, 59, 64, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                            hoverBorderColor: "rgba(255, 59, 64, 1)",
                                            data: [],
                                        }
                                     ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo2 = new Chart(total_min, {
                                 type: parser2.type,
                                 data: {
                                     labels: parser2.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser2.data,
                                        }
                                     ]
                                }
                            });
                        }
                        //TIEMPO MEDIO VISIONADO EN MINUTOS
                        var parser3 = $.parseJSON(data[2]);
                        var promedio = $("#graficop3");
                        if (jQuery.isEmptyObject(parser3.data)){
                            var grafo3 = new Chart(promedio, {
                                 type: parser3.type,
                                 data: {
                                     labels: parser3.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(255, 59, 64,0.2)",
                                            borderColor: "rgba(255, 59, 64, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                            hoverBorderColor: "rgba(255, 59, 64, 1)",
                                            data: [],
                                        }
                                     ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo3 = new Chart(promedio, {
                                 type: parser3.type,
                                 data: {
                                     labels: parser3.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser3.data,
                                        }
                                     ]
                                }
                            });
                        }
                        //TRAFICO DIARIO EN MEGABYTES
                        var parser4 = $.parseJSON(data[3]);
                        var megas = $("#graficop4");
                        if (jQuery.isEmptyObject(parser4.data)){
                            var grafo4 = new Chart(megas, {
                                 type: parser4.type,
                                 data: {
                                     labels: parser4.labels,
                                     datasets: [
                                        {
                                            label: "GB",
                                            backgroundColor: "rgba(255, 59, 64,0.2)",
                                            borderColor: "rgba(255, 59, 64, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                            hoverBorderColor: "rgba(255, 59, 64, 1)",
                                            data: [],
                                        }
                                     ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo4 = new Chart(megas, {
                                 type: parser4.type,
                                 data: {
                                     labels: parser4.labels,
                                     datasets: [
                                        {
                                            label: "GB",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser4.data,
                                        }
                                     ]
                                }
                            });
                        }
                        //MAXIMO DE SIMULTANEOS EN PERSONAS
                        var parser5 = $.parseJSON(data[4]);
                        var maximo = $("#graficop5");
                        if (jQuery.isEmptyObject(parser5.data)){
                            var grafo5 = new Chart(maximo, {
                                 type: parser5.type,
                                 data: {
                                     labels: parser5.labels,
                                     datasets: [
                                        {
                                            label: "players",
                                            backgroundColor: "rgba(255, 59, 64,0.2)",
                                            borderColor: "rgba(255, 59, 64, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                            hoverBorderColor: "rgba(255, 59, 64, 1)",
                                            data: [],
                                        }
                                     ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo5 = new Chart(maximo, {
                                 type: parser5.type,
                                 data: {
                                     labels: parser5.labels,
                                     datasets: [
                                        {
                                            label: "players",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser5.data,
                                        }
                                     ]
                                }
                            });
                        }
                        //HORA DEL PICO DE AUDIENCIA
                        var parser6 = $.parseJSON(data[5]);
                        var horaPico = $("#graficop6");
                        if (jQuery.isEmptyObject(parser6.data)){
                            var grafo6 = new Chart(horaPico, {
                                 type: parser6.type,
                                 data: {
                                     labels: parser6.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(255, 59, 64,0.2)",
                                            borderColor: "rgba(255, 59, 64, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(255, 59, 64, 0.4)",
                                            hoverBorderColor: "rgba(255, 59, 64, 1)",
                                            data: [],
                                        }
                                     ]
                                },
                                options: {
                                    scales: {
                                        yAxes: [{
                                          ticks: {
                                            beginAtZero:true,
                                          }
                                        }],
                                        xAxes: [{
                                          ticks: {
                                            beginAtZero: true
                                          }
                                        }]
                                    }
                                }
                            });
                        }else{
                            var grafo6 = new Chart(horaPico, {
                                 type: parser6.type,
                                 data: {
                                     labels: parser6.labels,
                                     datasets: [
                                        {
                                            label: "hours",
                                            backgroundColor: "rgba(67, 196, 54, 0.2)",
                                            borderColor: "rgba(67, 196, 54, 1)",
                                            borderWidth: 1,
                                            hoverBackgroundColor: "rgba(67, 196, 54, 0.4)",
                                            hoverBorderColor: "rgba(67, 196, 54, 1)",
                                            data: parser6.data,
                                        }
                                     ]
                                }
                            });
                        }
                    });
                });
            });
    </script>
</body> 
</html>
